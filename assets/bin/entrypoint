#!/bin/bash
#=====================
# Environment variables
#=====================
set -x

export DISPLAY=:3

function run_xvfb() {
        killall Xvfb && pgrep Xvfb || Xvfb $DISPLAY -screen 0 $X11_RESOLUTION &> /dev/null &
}
function run_x11vnc() {
        killall x11vnc && pgrep x11vnc || x11vnc -display $DISPLAY -shared -xkb -skip_lockkeys -forever -noxdamage -passwd $VNC_PASSWD &> /dev/null &
}

ENTRYPOINT_ARGS="$@"
PROJECT_DIR="/src"


# starting xvfb and x11vnc
run_xvfb &> /dev/null &
run_x11vnc &> /dev/null &

# Running commands for tests
if [ -n "$DOCKER_TESTS_COMMAND" ]
then
  cd $PROJECT_DIR
  # perform the command
  /bin/bash -c "$DOCKER_TESTS_COMMAND"
fi


